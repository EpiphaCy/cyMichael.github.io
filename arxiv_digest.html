<html lang="zh-cn">

<head>
    <meta name="viewport" content="initial-scale=1, user-scalable=0, minimal-ui" charset="UTF-8">
    <title>Xisen's Page</title>
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./dist/dropload.js"></script>
    <link rel="stylesheet" href="./dist/page.css">
    <link rel="stylesheet" href="./dist/dropload.css">
</head>

<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Xisen Jin's Page</a>
                <form class="navbar-form navbar-left" action="" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" id="search_input" placeholder="Search from Arxiv Digest">
                        </div>
                        <button class="btn btn-default" id="search">Search Arxiv</button>
                </form>
                <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Techblogs <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li><a href="https://aucson.github.io/ml-techblog/">Machine Learning</a></li>
                    <li><a href="https://aucson.gitbooks.io/leetcode-rec/content/">Leetcode Personal</a></li>
                  </ul>
                </li>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
        <div class="col-md-8 col-md-offset-2">          
            <p style="text-align:right">
                Arxiv Digest - Recent arxiv papers (Pure JS!)
            <p>
        </div>
        </div>
        <div class="row">
            <div class="col-md-8 col-md-offset-2">    
                <div class="content">
                    <div class="lists" id="list"></div>
                </div>
            </div>
        </div>
     </div>

</body>
<script>
    var $_GET = (function(){
        var url = window.document.location.href.toString();
        var u = url.split("?");
        if(typeof(u[1]) == "string"){
            u = u[1].split("&");
            var get = {};
            for(var i in u){
                var j = u[i].split("=");
                get[j[0]] = j[1];
            }
            return get;
        } else {
            return {};
        }
    })();

    var topic = $_GET['topic'];
    if(!topic){
        topic = "cs.CL";
    }

    $('#search_input').attr("placeholder",topic)

    var start_index = 0;
    // 每页展示5个
    var size = 5;
    var reg_clear =false;

    //search
    $('form').submit(function(){
        window.location.href = 'index.html?topic=' + $('input').val();
        return false;
    })

    $(function(){
    // dropload
    $('.content').dropload({
        scrollArea : window,
        loadDownFn : function(me){
            // 拼接HTML
            var result = '';
            $.ajax({
                url: "https://export.arxiv.org/api/query?search_query=all:" + topic + "&id_list=&start="
                    +start_index+"&max_results="+size
                    +"&sortBy=lastUpdatedDate",
                dataType: "xml",
                success: function(data){
                    entries = $(data).find("entry");
                    start_index += entries.length;
                    if(entries.length > 0){
                        $(data).find("entry").each(function(index,elem){
                            var title = $(elem).find('title').text();
                            var summary = $(elem).find('summary').text();
                            var date = $(elem).find('updated').text().replace("T"," ").replace("Z"," ");
                            var name = $(elem).find('author');
                            var strname = '';
                            name.each(function(index,item){
                                strname += $(item).find('name').text();
                                if(index!=name.length-1){
                                    strname += ', '
                                }
                            })
                            var link = $(elem).find('id').text();
                            result += '<div class="item opacity">' +
                                "<h3>" + title + "</h3>" +
                                "<p class='date'>" + date + "\n" + strname + "</p><br>" +
                                "<p>" + summary + "</p>" +
                                "<a class='origin' href='" + link + "'>more</a>" +
                                "</div>";
                        })
                    }else{
                        // 锁定
                        me.lock();
                        // 无数据
                        me.noData();
                    }
                    // 为了测试，延迟1秒加载
                    setTimeout(function(){
                        // 插入数据到页面，放到最后面
                        $('.lists').append(result);
                        // 每次数据插入，必须重置
                        me.resetload();
                    },500);
                },
                error: function(xhr, type){
                    alert('Ajax error!');
                    // 即使加载出错，也得重置
                    me.resetload();
                }
            });
        }
    });
    });

</script>
</html>
